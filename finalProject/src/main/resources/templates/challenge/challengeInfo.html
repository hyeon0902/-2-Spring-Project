<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>챌린지 상세정보</title>
</head>
<body>
	<section layout:fragment="content">
<div class="comment-form">
			<section class="blog_area single-post-area">
				<a
				th:href="@{/challenge/challengeInfo(chalId=${session.challengeInfo.chalId})}">챌린지소개</a>
			<a
				th:href="@{/challenge/challengesList(chalId=${session.challengeInfo.chalId})}">챌린지참여</a>
					<div class="container" style="border: 1px solid black;">
						<div class="row">
							<div class="col-lg-8 posts-list">
								<div class="single-post row">
									<div class="col-lg-12">
										<div class="feature-img">

											<img th:if="${FileList != null and not #lists.isEmpty(FileList) and FileList[0] != null}"  th:src="${FileList[0].filePath}" alt=""><br>
											
										</div>
									</div>

									<div class="col-lg-12 col-md-12 blog_details">
										<div class="form-group">
											<p th:text="${session.challengeInfo.title}"></p>

										</div>
									</div>

									<div class="col-lg-12">
										<div class="row">


									<h3>챌린지 하는 이유</h3>
											<div class="col-6">
												<div class="form-group">
													<img  th:if="${FileList != null and not #lists.isEmpty(FileList) and FileList[1] != null}" th:src="${FileList[1].filePath}" alt="">
												</div>
											</div>
											<div class="col-6">
												<div class="form-group">
													<img  th:if="${FileList != null and not #lists.isEmpty(FileList) and FileList[2] != null}" th:src="${FileList[2].filePath}" alt="">
												</div>
											</div>



											<div class="col-lg-12 mt-25">
												<div class="form-group">
													<textarea th:text="${session.challengeInfo.actionReason}"></textarea>
												</div>

											</div>

									<h3>기대효과</h3>
											<div class="col-6">
												<div class="form-group">
													<img  th:if="${FileList != null and not #lists.isEmpty(FileList) and FileList[3] != null}" th:src="${FileList[3].filePath}" alt="">
												</div>
											</div>
											<div class="col-6">
												<img th:if="${FileList != null and not #lists.isEmpty(FileList) and FileList[4] != null}" th:src="${FileList[4].filePath}" alt="">
											</div>



											<div class="col-lg-12 mt-25">
												<div class="form-group">
													<textarea th:text="${session.challengeInfo.expImpact}"></textarea>
												</div>
											</div>





											<!-- <div class="col-6">
												<div class="form-group">
													<input type="text" class="form-control" id="subject"
														th:readonly placeholder="그외 자유내용 들어갈 자리입니다"> <img
														class="img-fluid" src="image/blog/post-img1.jpg" alt="">
												</div>
											</div>
											<div class="col-6">
												<div class="form-group">
													<input type="text" class="form-control" id="subject"
														th:readonly placeholder="그외 자유내용 이미지 들어갈 자리입니다"> <img
														class="img-fluid" src="image/blog/post-img2.jpg" alt="">
												</div>
											</div> -->



											<div class="col-lg-12 mt-25">
												<div class="form-group">
													<textarea th:text="${session.challengeInfo.content}"></textarea>
												</div>

											</div>


						<!-- 					<p>함께할 날짜</p>
											<div class="form-group form-inline">

												<div class="form-group col-lg-6 col-md-6 name">
													<input type="date" id="start" name="start">
													<p>"챌린지를 시작하는 날짜는 오늘입니다"</p>
												</div>
												<div class="form-group col-lg-6 col-md-6 name">
													<input type="date" id="regDate" name="regDate">
													<p>챌린지를 마감할 날짜오늘부터 최소 한달, 최대 6개월까지 참여가능합니다</p>

												</div>
											</div>
 -->

											<div class="form-group">
												<p>HowTo</p>


												<p th:text="${session.challengeInfo.partMethod1}" style="width: 500px"></p>
												<hr>
												<p th:text="${session.challengeInfo.partMethod2}" style="width: 500px"></p>
											</div >
										
										</div>
									</div>
								</div>
						

							</div>

							
					<div class="col-lg-4">
						<div class="blog_right_sidebar">
							<aside class="single_sidebar_widget popular_post_widget">
								<h3 class="widget_title"
									th:text="${session.challengeInfo.title}"></h3>
								<div class="media post_item">
									<img th:src="${FileList[0].filePath}" alt="post">

									<div class="media-body">
										<h3>How to</h3>
										<p th:text="${session.challengeInfo.partMethod1}"></p>
										<p th:text="${session.challengeInfo.partMethod2}"></p>
										<button type="button" data-toggle="modal"
											data-target="#myModal">챌린지 참여하기</button>
									</div>
								</div>
							</aside>
						</div>
					</div>
						</div>

					</div>
			
					<!-- 여기 세션 만들어서 주기 Info에서 넘어온다-->

			<div class="modal" tabindex="-1" id="myModal">
				<div
					class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">챌린지 참여하기</h5>
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">


							<div class="form-group">
								<img id="imagePreview" src="/image/초록개구리.png"
									style="border-radius: 100%; width: 100px; height: 100px;">

								<label for="file-image" class="input-file-button">이미지첨부
									<input type="file" name="uploadFiles" id="file-image"
									style="display: none" multiple>
								</label> <br>
								<!-- <label for="file-video" class="input-file-button">영상첨부
								<input type="file" id="file-video" style="display: none">
								</label> -->
								<textarea id="content" name="content" maxlength="500"></textarea>
							</div>

						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
								data-dismiss="modal">Close</button>
							<button type="submit" class="btn btn-primary uploadBtn">Save
								changes</button>
						</div>
					</div>

				</div>
			</div>
			
			<script>
		$(document).ready(function() {
			// 모달이 표시될 때 이벤트 처리
			$('#myModal').on('show.bs.modal', function(e) {
			
				document.getElementById('file-image').addEventListener('change', function (event) {
					var image = document.getElementById('imagePreview');
					var file = event.target.files[0];
					var reader = new FileReader();

					reader.onloadend = function () {
						image.src = reader.result;
					}

					if (file) {
						reader.readAsDataURL(file);
					} else {
						image.src = "";
					}
				});


				$('.uploadBtn').click(function () {
					var formData = new FormData(); //FormData 객체 생성
					var inputFile = $("input[type='file']");
					//input 태그의 type이 file인것을 찾아서 inputFile이라는 변수로 지정
					var files = inputFile[0].files;
					//files : 선택한 모든 파일을 나열하는 FileList 객체입니다.
					//multiple 특성을 지정하지 않닸다면 두 개 이상의 파일을 포함하지 않습니다.
					for (var i = 0; i < files.length; i++) {
						console.log(files[i]);
						formData.append("uploadFiles", files[i]); //키,값으로 append 
					}
					
					formData.append("chalId", [[${session.challengeInfo.chalId}]])
					formData.append("dContent", $('#content').val());
				//	formData.append("code", "p04")
				//	formData.append("codeNo", $('#chalDetId').val());

					//jQuery.ajax
					$.ajax({
						url: '/challenge/challengeDeInsert',
						type: 'POST',
						processData: false, //기본값은 true, ajax 통신을 통해 데이터를 전송할 때, 기본적으로 key와 value값을 Query String으로 변환해서 보냅니다.
						contentType: false, // multipart/form-data타입을 사용하기위해 false 로 지정합니다.
						data: formData,
						success: function (result) {
							console.log(result)
							alert('성공!')

						},
						error: function (reject) {
							alert('실풰!')
							console.log(reject);
						}
					});
				});
			
			});

			// 모달이 숨겨질 때 이벤트 처리
			$('#myModal').on('hidden.bs.modal', function(e) {
				// 모달이 숨겨질 때 실행할 코드
			});
		});
	</script>
			
		</section>
		</div>
	</section>
	
	
</body>
</html>