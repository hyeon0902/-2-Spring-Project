<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
	 xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
.hidden {
	display: none;
}
</style>
</head>
<body>
	<section layout:fragment="content">
	<div>
		<div class="area_thumb">
			<h1>프로필</h1>
			<a data-tiara-layer="profile_img" data-tiara-action-name="프로필수정_클릭" class="link_thumb" href="/profile">
				<span class="profile_thumb">
				<img style="border-radius: 50%; width: 100px; height: 100px;" alt="프로필 사진" class="img_thumb" src="https://t1.kakaocdn.net/together_image/common/avatar/avatar04.png">
				</span>
			</a>
		</div>
		<div>
				<label>닉네임</label>
				<input type="text">
				<br>
				<label>전화번호</label>
				<div id="contents"> 
				<input type="text" id="to" name="to" placeholder="전화번호를 입력해주세요"/>   <!-- 인증번호 받을사람 휴대폰 번호 -->
					<button type="button" id="send">보내기</button><br> <!-- 문자보내는 전송버튼 -->
					
				<input type="text" id="userNum" class="hidden" placeholder="인증번호 4자리를 입력하세요">   <!-- 인증번호 입력창 -->
					<button type="button" id="enterBtn" class="hidden">확인</button>  <!-- 인증번호와 내가 입력창에 입력한 인증번호 비교하는 창 -->		
				<input type="text" id="changeNum" class="hidden" placeholder="변경하실 전화번호를 입력하세요">   <!-- 인증번호 입력창 -->
					<button type="button" id="changeBtn" class="hidden">변경</button>  <!-- 인증번호와 내가 입력창에 입력한 인증번호 비교하는 창 -->	
			    <label id="changeTel" class="hidden">010-8898-8034</label>
			    </div>
				<br>
				<div id="emailVerification">
				  <input type="email" id="recipientEmail" placeholder="이메일 주소를 입력하세요">
				  <button id="sendButton">인증번호 전송</button>
				  <br>
				  <input type="text" id="verificationCode" placeholder="인증번호를 입력하세요">
				  <button id="verifyButton">인증번호 확인</button>
				  <br>
				  <div id="message"></div>
				</div>

				<br>
				<label>나이</label>
				<select class="box" id="year">
				    <option>선택안함</option>
				</select>
				<br>
				<label>성별</label>
				<br>
				<div>
					<span>
						<input type="radio" id="Gender1" name="group" value="남자">
						<label>남자</label>
					</span>
					<span>
						<input type="radio" id="Gender2" name="group" value="여자">
						<label>여자</label>
					</span>
					<span>					
						<input type="radio" id="Gender3" name="group" value="선택안함">
						<label>선택안함</label>
					</span>
				</div>
				<br>
				<label>지역</label>
				<select name="sido1" id="sido1"></select>
				<select name="gugun1" id="gugun1"></select>
<!-- 			</form> -->
		</div>
	</div>
	<script type="text/javascript">
	// '출생 연도' 셀렉트 박스 option 목록 동적 생성
	let year = document.querySelector('#year')
	// option 목록 생성 여부 확인
	isYearOptionExisted = false;
	year.addEventListener('focus', function () {
		  // year 목록 생성되지 않았을 때 (최초 클릭 시)
		  if(!isYearOptionExisted) {
		    isYearOptionExisted = true;
		    for(let i = 1940; i <= 2010; i++) {
		      // option element 생성
		      let YearOption = document.createElement('option');
		      YearOption.setAttribute('value', i);
		      YearOption.innerText = i + '년생';
		      // year의 자식 요소로 추가
		      this.appendChild(YearOption);
		  	}
		  }
		});
	
	
	let selectYearValue = document.querySelector("#year");

	selectYearValue.addEventListener("change", (event) => {
	  console.log(`${event.target.value}`,'생년원일');
	});
	
	let selectGenderValue = document.querySelector('input[type=radio][name=group]');

	selectGenderValue.addEventListener("change", (event) => {
	  selectGenderValue = document.querySelector('input[type=radio][name=group]:checked');
	  alert(selectGenderValue.value);
	});
	  
	
	$('#send').click(function() {
		const to = $('#to').val();
		if(to){
			alert('메세지를 전송하였습니다. 메세지를 확인해주세요.');
	    	$("input").remove("#to");
	    	$("button").remove("#send");
	        $("#userNum").removeClass('hidden');
	        $("#enterBtn").removeClass('hidden');
			
			$.ajax ({
				url: '/sendSMS',
				type: 'GET',
				data: {
					"to" : to
				},
				success: function(data) {
					const checkNum = data;
					
					$('#enterBtn').click(function() {	
						const userNum = $('#userNum').val();
						
						if(checkNum === userNum) {
							alert('인증 성공하였습니다.');
					    	$("input").remove("#userNum");
						 	$("button").remove("#enterBtn");
						 	$("#changeNum").removeClass('hidden');
					     	$("#changeBtn").removeClass('hidden');
					     	
					     	$("#changeBtn").on('click', function(){
					        	alert('변경이 완료되었습니다.');
					        	$("input").remove("#changeNum");
							 	$("button").remove("#changeBtn");
							 	$("button").removeClass("#changeTel");
					        })
					        
						}
						else {
							alert('인증 실패하였습니다. 다시 입력해주세요.');
						}
					});
					
				}
			});
		}else{
			alert('전화번호를 입력해주세요');	
		}
	});
// 인증번호 전송
$('#sendButton').click(function() {
  var recipientEmail = document.getElementById("recipientEmail").value;
  
  if (recipientEmail == "") {
    alert("이메일 주소를 입력하세요.");
    return;
  }

  alert("인증번호가 발송되었습니다.");
  $.ajax({
    type: "POST",
    url: "/email/send",
    data: { recipientEmail: recipientEmail },
    success: function (response) {
      // 이메일 전송 성공 시 처리
      document.getElementById("message").innerText = "이메일이 성공적으로 전송되었습니다.";
      document.getElementById("message").style.color = "green"; // 성공 메시지를 초록색으로 표시
    },
    error: function (xhr, status, error) {
      // 이메일 전송 실패 시 처리
      document.getElementById("message").innerText = "이메일 전송 중 오류가 발생했습니다.";
      document.getElementById("message").style.color = "red"; // 실패 메시지를 빨간색으로 표시
    },
  });
});

// 인증번호 확인
$('#verifyButton').click(function() {
  var recipientEmail = document.getElementById("recipientEmail").value;
  var verificationCode = document.getElementById("verificationCode").value;

  if (verificationCode == "") {
    alert("인증번호를 입력하세요.");
    return;
  }

  $.ajax({
    type: "GET",
    url: "/email/verify",
    data: {
      recipientEmail: recipientEmail,
      verificationCode: verificationCode,
    },
    success: function (response) {
	  // 인증 성공 시 처리
	  if (response == "success") {
	    document.getElementById("message").innerText = "인증번호가 확인되었습니다.";
	    document.getElementById("message").style.color = "green"; // 성공 메시지를 초록색으로 표시
	  } else {
	    document.getElementById("message").innerText = "인증번호가 일치하지 않습니다. 다시 한번 정확히 입력해 주세요.";
	    document.getElementById("message").style.color = "red"; // 실패 메시지를 빨간색으로 표시
	  }
	},
  });
});
	</script>
	</section>
	
</body>
</html>
