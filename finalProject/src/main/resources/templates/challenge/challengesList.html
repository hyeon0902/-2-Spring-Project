<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>챌린지 참여 리스트</title>

<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.6.0/kakao.min.js"
  integrity="sha384-6MFdIr0zOira1CHQkedUqJVql0YtcZA1P0nbPrQYJXVJZUkTk/oX4U9GhUIs3/z8" crossorigin="anonymous"></script>
<script>
  Kakao.init('67b63dfc4457584184ee614818f5a9c7'); // 사용하려는 앱의 JavaScript 키 입력
</script>


<style>
.input-file-button {
	padding: 6px 25px;
	background-color: yellowgreen;
	border-radius: 4px;
	color: white;
	cursor: pointer;
}
.gallery_img {
    position: relative;
    display: inline-block;
}

.image-container {
    position: relative;
    display: inline-block;
}

.bi-heart {
    position: absolute;
    bottom: 0;
    right: 0;
}
.bi-heart.filled path {
    fill: red;
}

</style>
</head>
<body>
<section layout:fragment="content">
	<section class="blog_area">
		<div class="container">
			<div class="row">
				<th:block th:each="list: ${challengesList}">
				<div class="col-lg-8">
					<div class="blog_left_sidebar">
						<div class="col-md-4 gallery_item">
							<img th:each="file : ${list.file}" th:src="${file.filePath}">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-suit-heart" viewBox="0 0 16 16"><path d="m8 6.236-.894-1.789c-.222-.443-.607-1.08-1.152-1.595C5.418 2.345 4.776 2 4 2 2.324 2 1 3.326 1 4.92c0 1.211.554 2.066 1.868 3.37.337.334.721.695 1.146 1.093C5.122 10.423 6.5 11.717 8 13.447c1.5-1.73 2.878-3.024 3.986-4.064.425-.398.81-.76 1.146-1.093C14.446 6.986 15 6.131 15 4.92 15 3.326 13.676 2 12 2c-.777 0-1.418.345-1.954.852-.545.515-.93 1.152-1.152 1.595L8 6.236zm.392 8.292a.513.513 0 0 1-.784 0c-1.601-1.902-3.05-3.262-4.243-4.381C1.3 8.208 0 6.989 0 4.92 0 2.755 1.79 1 4 1c1.6 0 2.719 1.05 3.404 2.008.26.365.458.716.596.992a7.55 7.55 0 0 1 .596-.992C9.281 2.049 10.4 1 12 1c2.21 0 4 1.755 4 3.92 0 2.069-1.3 3.288-3.365 5.227-1.193 1.12-2.642 2.48-4.243 4.38z"/></svg>
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-suit-heart-fill" viewBox="0 0 16 16"> <path d="M4 1c2.21 0 4 1.755 4 3.92C8 2.755 9.79 1 12 1s4 1.755 4 3.92c0 3.263-3.234 4.414-7.608 9.608a.513.513 0 0 1-.784 0C3.234 9.334 0 8.183 0 4.92 0 2.755 1.79 1 4 1z"/></svg>
							<svg data-toggle="modal" data-target="#myModal3" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-emoji-frown" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M4.285 12.433a.5.5 0 0 0 .683-.183A3.498 3.498 0 0 1 8 10.5c1.295 0 2.426.703 3.032 1.75a.5.5 0 0 0 .866-.5A4.498 4.498 0 0 0 8 9.5a4.5 4.5 0 0 0-3.898 2.25.5.5 0 0 0 .183.683zM7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z"/></svg>					
		    			</div>				
							<div class="hover">
								<a class="light"><i class="fa fa-expand"></i></a>
							</div>
								<p th:text="${list.memId}"></p>
								<div class="getChalId" data-boardId="[[${list.chalDetId}]]"></div>
					</div>
				</div>
				</th:block>
<!-- 여기 세션 만들어서 주기 Info에서 넘어온다-->
	            <div class="col-lg-4">
		  			<div class="blog_right_sidebar">
						<aside class="single_sidebar_widget popular_post_widget">
				<h3 class="widget_title" th:text="${session.challengeInfo.title}"></h3>
				<div class="media post_item">
					<img th:if="${session.FileList != null and !session.FileList.isEmpty()}"  th:src="${session.FileList[0].filePath}" alt="post">

					<div class="media-body">
						<h3>How to</h3>
						<p th:text="${session.challengeInfo.partMethod1}"></p>
						<p th:text="${session.challengeInfo.partMethod2}"></p>
						<button type="button" data-toggle="modal"
							data-target="#myModal">챌린지 참여하기</button>
							<a id="kakaotalk-sharing-btn" href="javascript:;">
  <img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png" alt="카카오톡 공유 보내기 버튼" /></a>
			</div>
		</div>
	</aside>
  </div>
 </div>

</div>
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down-circle" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z"/></svg>

</div>
<!-- 신고사유받기 모달-->
<div class="modal" tabindex="-1" id="myModal3">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">신고하기</h5>
        	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
          	<span aria-hidden="true">&times;</span>
        	</button>
      </div>
      <div class="modal-body">
		 <div class="form-group">
		    <label class="form-check-label" for="s01">스팸홍보/도배글
		    <input class="form-check-input" id="s01" type="radio" name="reason" value="s01" th:attr="onclick='getRadioValue()'"></label>
		    <label class="form-check-label" for="s02">음란물
		    <input class="form-check-input" id="s02" type="radio" name="reason" value="s02" th:attr="onclick='getRadioValue()'"></label>
		    <label class="form-check-label" for="s03">불법정보 포함
		    <input class="form-check-input" id="s03" type="radio" name="reason" value="s03" th:attr="onclick='getRadioValue()'"></label>
		    <label class="form-check-label" for="s04">혐오/차별적 표현
		    <input class="form-check-input" id="s04" type="radio" name="reason" value="s04" th:attr="onclick='getRadioValue()'"></label>
		    <label class="form-check-label" for="s05">주제와 상관이 없음
		    <input class="form-check-input" id="s05" type="radio" name="reason" value="s05" th:attr="onclick='getRadioValue()'"></label>
		</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary reportBtn">신고</button>
      </div>
      
	    </div>
	  </div>
	</div>						
<!--  -->
<div class="modal" tabindex="-1" id="myModal">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
    
      <div class="modal-header">
        <h5 class="modal-title">챌린지 참여하기</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
     
      
							<div class="form-group">
								<img id="imagePreview" src="/userresources/image/심사방법.png" style="border-radius: 100%; width: 100px; height: 100px;">
					               
								<label for="file-image" class="input-file-button" >이미지첨부 
								<input type="file" name="uploadFiles" id="file-image" style="display: none">
								</label> 
								<br> 
								<!-- <label for="file-video" class="input-file-button">영상첨부
								<input type="file" id="file-video" style="display: none">
								</label> -->
								<textarea id="content" name="content" maxlength="500"></textarea>
							</div>
						
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary uploadBtn">Save changes</button>
      </div>

    </div>
  </div>
</div>		
<script>
/* function toggleHeartColor() {
    var heartIcon = document.querySelector('.bi-heart');
    heartIcon.classList.toggle('filled');
    
    var boardId = document.querySelector('.getChalId').getAttribute('data-boardId');
    console.log('boardId:', boardId); 
    $.ajax({
        type: 'POST',
        url: 'challengeLike',
        data: {
        	boardId: boardId
        },
        success: function(result) {
            console.log(result);
            
        },
        error: function(error) {
            console.log(error);
        }
    });
} */
		$(document).ready(function() {
			// 모달이 표시될 때 이벤트 처리
			$('#myModal').on('show.bs.modal', function(e) {
			
				document.getElementById('file-image').addEventListener('change', function (event) {
					var image = document.getElementById('imagePreview');
					var file = event.target.files[0];
					var reader = new FileReader();

					reader.onloadend = function () {
						image.src = reader.result;
					}

					if (file) {
						reader.readAsDataURL(file);
					} else {
						image.src = "";
					}
				});


				$('.uploadBtn').click(function () {
					var formData = new FormData(); //FormData 객체 생성
					var inputFile = $("input[type='file']");
					//input 태그의 type이 file인것을 찾아서 inputFile이라는 변수로 지정
					var files = inputFile[0].files;
					//files : 선택한 모든 파일을 나열하는 FileList 객체입니다.
					//multiple 특성을 지정하지 않닸다면 두 개 이상의 파일을 포함하지 않습니다.
					for (var i = 0; i < files.length; i++) {
						console.log(files[i]);
						formData.append("uploadFiles", files[i]); //키,값으로 append 
					}
					
					formData.append("chalId", [[${session.challengeInfo.chalId}]])
					formData.append("dContent", $('#content').val());
				//	formData.append("code", "p04")
				//	formData.append("codeNo", $('#chalDetId').val());

					//jQuery.ajax
					$.ajax({
						url: '/challenge/challengeDeInsert',
						type: 'POST',
						processData: false, //기본값은 true, ajax 통신을 통해 데이터를 전송할 때, 기본적으로 key와 value값을 Query String으로 변환해서 보냅니다.
						contentType: false, // multipart/form-data타입을 사용하기위해 false 로 지정합니다.
						data: formData,
						success: function (result) {
							console.log(result)
							alert('성공!')
							 $("#myModal").modal("hide");
						},
						error: function (reject) {
							alert('실풰!')
							console.log(reject);
						}
					});
				
					 
				
				});
			
			});

		});
		
/* function getRadioValue() {
    var reason = $('input[name="reason"]:checked').val();
    console.log(reason); 
    
    $.ajax({
    	url: '/reportInsert',
    	type: 'POST',
    	processData: false, //기본값은 true, ajax 통신을 통해 데이터를 전송할 때, 기본적으로 key와 value값을 Query String으로 변환해서 보냅니다.
    	contentType: false, // multipart/form-data타입을 사용하기위해 false 로 지정합니다.
    	data: reason,
    	success: function (result) {
    		console.log(result)
    		alert('성공!')

    	},
    	error: function (reject) {
    		alert('실패!')
    		console.log(reject);
    	}
    });
}	
 */
 
 function getRadioValue() {
	    var reason = $('input[name="reason"]:checked').val();
	    console.log(reason); 
	    
	  
	    $('.reportBtn').click(function () {
	    $.ajax({
	        url: '/reportInsert?repResaon'+reason, // 실제 서버의 URL로 수정해야 함
	        type: 'POST',
	        processData: false,
			contentType: false, 
	        success: function (result) {
	            console.log(result);
	            alert('성공!');
	        },
	        error: function (reject) {
	            alert('실패!');
	            console.log(reject);
	        }
	    });
	});
 }
	</script>

	<script>
  Kakao.Share.createCustomButton({
    container: '#kakaotalk-sharing-btn',
    templateId: 103903,
   /*  templateArgs: {
      title: '라이언이 즐겨먹던 바로 그 틴케이스 치즈볼',
      description: '바라만 봐도 즐거워지는 힐링 패키지에는 시크릿 스토리가 숨어있어요.',
    }, */
  });
</script>
	

</section>

</section>

















	
	

</body>
</html>