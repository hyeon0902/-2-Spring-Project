<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>챌린지 참여 리스트</title>

<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.6.0/kakao.min.js"
  integrity="sha384-6MFdIr0zOira1CHQkedUqJVql0YtcZA1P0nbPrQYJXVJZUkTk/oX4U9GhUIs3/z8" crossorigin="anonymous"></script>
<script>
  Kakao.init('67b63dfc4457584184ee614818f5a9c7'); // 사용하려는 앱의 JavaScript 키 입력
</script>


<style>
.input-file-button {
	padding: 6px 25px;
	background-color: yellowgreen;
	border-radius: 4px;
	color: white;
	cursor: pointer;
}
</style>
</head>
<body>

	<section layout:fragment="content">
		
			<section class="blog_area">
				<div class="container">
					<div class="row">
					<th:block th:each="list:${challengesList}">
					
						<div class="col-lg-8">
							<div class="blog_left_sidebar">
								
								
									<div class="col-md-4 gallery_item">
										<div class="gallery_img">
											<img th:src="${list.file.filePath}" alt="post">
											<div class="hover">
												<a class="light"><i class="fa fa-expand"></i></a>
											</div>
										</div>
										<p th:text="${list.memId}"></p>
									</div>

								


							</div>
						</div>
						
						</th:block>
						<!-- 여기 세션 만들어서 주기 Info에서 넘어온다-->
					
							<div class="col-lg-4">
								<div class="blog_right_sidebar">
									<aside class="single_sidebar_widget popular_post_widget">
										<h3 class="widget_title" th:text="${session.challengeInfo.title}"></h3>
										<div class="media post_item">
											<img th:if="${list != null and !list.isEmpty()}" th:src="${list[0].file.filePath}" alt="post">

											<div class="media-body">
												<h3>How to</h3>
												<p th:text="${session.challengeInfo.partMethod1}"></p>
												<p th:text="${session.challengeInfo.partMethod2}"></p>
												<button type="button" data-toggle="modal"
													data-target="#myModal">챌린지 참여하기</button>
													<a id="kakaotalk-sharing-btn" href="javascript:;">
  <img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png"
    alt="카카오톡 공유 보내기 버튼" />
</a>





<div class="modal" tabindex="-1" id="myModal">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
    
      <div class="modal-header">
        <h5 class="modal-title">챌린지 참여하기</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
     
      
							<div class="form-group">
								<img id="imagePreview" src="/userresources/image/심사방법.png" style="border-radius: 100%; width: 100px; height: 100px;">
					               
								<label for="file-image" class="input-file-button" >이미지첨부 
								<input type="file" name="uploadFiles" id="file-image" style="display: none">
								</label> 
								<br> 
								<!-- <label for="file-video" class="input-file-button">영상첨부
								<input type="file" id="file-video" style="display: none">
								</label> -->
								<textarea id="content" name="content" maxlength="500"></textarea>
							</div>
						
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary uploadBtn">Save changes</button>
      </div>
      
    </div>
  </div>
</div>

													
											</div>
										</div>
									</aside>
								</div>
							</div>
					</div>
				</div>
			
		
<script>
		$(document).ready(function() {
			// 모달이 표시될 때 이벤트 처리
			$('#myModal').on('show.bs.modal', function(e) {
			
				document.getElementById('file-image').addEventListener('change', function (event) {
					var image = document.getElementById('imagePreview');
					var file = event.target.files[0];
					var reader = new FileReader();

					reader.onloadend = function () {
						image.src = reader.result;
					}

					if (file) {
						reader.readAsDataURL(file);
					} else {
						image.src = "";
					}
				});


				$('.uploadBtn').click(function () {
					var formData = new FormData(); //FormData 객체 생성
					var inputFile = $("input[type='file']");
					//input 태그의 type이 file인것을 찾아서 inputFile이라는 변수로 지정
					var files = inputFile[0].files;
					//files : 선택한 모든 파일을 나열하는 FileList 객체입니다.
					//multiple 특성을 지정하지 않닸다면 두 개 이상의 파일을 포함하지 않습니다.
					for (var i = 0; i < files.length; i++) {
						console.log(files[i]);
						formData.append("uploadFiles", files[i]); //키,값으로 append 
					}
					
					formData.append("chalId", [[${session.challengeInfo.chalId}]])
					formData.append("dContent", $('#content').val());
				//	formData.append("code", "p04")
				//	formData.append("codeNo", $('#chalDetId').val());

					//jQuery.ajax
					$.ajax({
						url: '/challenge/challengeDeInsert',
						type: 'POST',
						processData: false, //기본값은 true, ajax 통신을 통해 데이터를 전송할 때, 기본적으로 key와 value값을 Query String으로 변환해서 보냅니다.
						contentType: false, // multipart/form-data타입을 사용하기위해 false 로 지정합니다.
						data: formData,
						success: function (result) {
							console.log(result)
							alert('성공!')
							 $("#myModal").modal("hidden.bs.modal");
						},
						error: function (reject) {
							alert('실풰!')
							console.log(reject);
						}
					});
				
					 
				
				});
			
			});

			// 모달이 숨겨질 때 이벤트 처리
			$('#myModal').on('hidden.bs.modal', function(e) {
				// 모달이 숨겨질 때 실행할 코드
			});
		});
	</script>

	<script>
  Kakao.Share.createCustomButton({
    container: '#kakaotalk-sharing-btn',
    templateId: 103903,
   /*  templateArgs: {
      title: '라이언이 즐겨먹던 바로 그 틴케이스 치즈볼',
      description: '바라만 봐도 즐거워지는 힐링 패키지에는 시크릿 스토리가 숨어있어요.',
    }, */
  });
</script>
	

</section>

</section>

















	
	

</body>
</html>